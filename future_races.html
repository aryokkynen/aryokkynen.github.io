<!DOCTYPE html>
<html lang="en">
<head>
  <title>Future races</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.4.1/css/bulma.css">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
<script>
$(document).ready(function(){

var race_api_url = "http://korpisoturit.com/api/misc/future_races";
fetchServerStatus();

function fetchServerStatus(){



    $.ajax({
        url: race_api_url,
        dataType: 'json',

        success: function( json ) {
                var d = new Date();

        if (json){
            var temp = "";
            var max_races = json.data.length;

            if (json.data.length > 17 ) {
                max_races = 17;
            }
            document.getElementById('serverStatus').innerHTML = "   pvm     klo    rata<br/>"
            for (var i = 0; i < max_races; i++) {
                try {
                    if (i > 0){
                        if (json.data[i].event.dayShort != json.data[i-1].event.dayShort){
                            document.getElementById('serverStatus').innerHTML += " " + json.data[i].event.dayShort + " " + json.data[i].event.singleLine + "<br/>" ;
                        }
                        else {
                            document.getElementById('serverStatus').innerHTML += "           " + json.data[i].event.singleLine + "<br/>" ;
                        }
                    } else {

                        document.getElementById('serverStatus').innerHTML += " " +json.data[i].event.dayShort + " " + json.data[i].event.singleLine + "<br/>" ;
                        
                    }
                }
                catch(err) {
                
                }
               
            };
            

            document.getElementById('serverStatus').innerHTML += "  Peliaika alkaa joka päivä kello 9";
            document.getElementById('updateTime').innerHTML = d.toLocaleTimeString();
        } 

        },
        
        error: function( json ) {
            var d = new Date();
            document.getElementById('serverStatus').innerHTML = "<section class='hero is-danger is-bold'> <div class='hero-body'> <div class='container'> <h1 class='title title is-1 is-large'>Server not responding</h1> </div></div></section>"

          
            document.getElementById('updateTime').innerHTML = d.toLocaleTimeString();
            
        }
        
    });

}
});

</script>
</head>
<body>
<div class="container is-fluid">
<div class="card">
    <header class="card-header">
        <p class="card-header-title">
            Future races
        </p>
    </header>
    <div class="card-content">
    <p class="title"><pre><div id='serverStatus' class='has-text-left'></div></pre></p>
    </div>
        <footer class="card-footer">
            <p class="card-footer-item">
                <span>Data loaded: <span id='updateTime'></span></span>
            </p>
        </footer>
    </div>
</div>
</body>
</html>